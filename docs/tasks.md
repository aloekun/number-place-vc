# Implementation Plan

- [x] 1. プロジェクト構造とコアインターフェースの設定
  - HTMLファイル、CSSファイル、JavaScriptモジュールのディレクトリ構造を作成
  - 基本的なHTMLテンプレートとCSSスタイルを実装
  - システム境界を定義するインターフェースを作成
  - _Requirements: 1.1, 2.1, 3.1_
  - **完了日: 2025-07-25**

- [x] 2. データモデルと検証機能の実装
- [x] 2.1 Grid Modelクラスの実装とテスト
  - 9×9グリッドを管理するGridクラスを実装
  - セル値の設定・取得メソッドを作成
  - ブロックインデックス計算機能を実装
  - Grid Modelの単体テストを作成
  - _Requirements: 2.1, 3.1, 3.2, 3.3_
  - **完了日: 2025-07-25**

- [x] 2.2 Rule Engineクラスの実装とテスト
  - 行・列・ブロックの重複検証機能を実装
  - ルール違反検出のメソッドを作成
  - Rule Engineの単体テストを作成
  - エラーケースの処理テストを実装
  - _Requirements: 3.1, 3.2, 3.3, 3.4_
  - **完了日: 2025-07-25**

- [x] 3. パズル生成機能の実装
- [x] 3.1 基本的な解生成アルゴリズムの実装
  - バックトラッキングを使用した完全解生成機能を実装
  - 解の妥当性検証機能を作成
  - 解生成機能の単体テストを実装
  - _Requirements: 1.1, 1.2_
  - **完了日: 2025-07-25**

- [x] 3.2 問題生成とヒント数調整機能の実装
  - 完全解からヒントを削除して問題を生成する機能を実装
  - 一意解の検証機能を実装
  - 難易度別のヒント数調整機能を作成
  - 問題生成機能の単体テストを実装
  - _Requirements: 1.1, 1.2, 1.3_
  - **完了日: 2025-07-25**

- [x] 4. ゲーム状態管理機能の実装
- [x] 4.1 Game State Managerクラスの実装
  - ゲーム状態を管理するクラスを実装
  - 新規ゲーム開始機能を作成
  - ゲーム完了判定機能を実装
  - Game State Managerの単体テストを作成
  - _Requirements: 1.4, 2.4, 4.4_
  - **完了日: 2025-07-25**

- [x] 4.2 操作履歴とundo機能の実装
  - ユーザー操作の履歴管理機能を実装
  - 元に戻す（undo）機能を作成
  - リセット機能を実装
  - 履歴管理機能の単体テストを作成
  - _Requirements: 4.1, 4.2, 4.3_
  - **完了日: 2025-07-25**

- [ ] 5. ユーザーインターフェースの実装
- [ ] 5.1 グリッド表示とセル選択機能の実装
  - 9×9グリッドのHTML/CSS表示を実装
  - セルクリックによる選択機能を作成
  - 選択状態の視覚的フィードバックを実装
  - グリッド表示機能のテストを作成
  - _Requirements: 2.1, 1.4_

- [ ] 5.2 数字入力とキーボード操作の実装
  - キーボードからの数字入力機能を実装
  - セルへの数字設定機能を作成
  - 入力値の検証とエラー表示を実装
  - 入力機能の統合テストを作成
  - _Requirements: 2.2, 2.3_

- [ ] 6. リアルタイム検証とエラー表示の実装
- [ ] 6.1 リアルタイムルール検証機能の実装
  - 数字入力時のリアルタイム検証を実装
  - ルール違反の視覚的ハイライト機能を作成
  - エラー状態の管理機能を実装
  - リアルタイム検証の統合テストを作成
  - _Requirements: 2.3, 3.1, 3.2, 3.3, 3.4_

- [ ] 7. ゲーム制御機能の実装
- [ ] 7.1 タイマーとゲーム完了機能の実装
  - 経過時間表示機能を実装
  - ゲーム完了検出と表示機能を作成
  - 完了時間の記録機能を実装
  - タイマー機能の統合テストを作成
  - _Requirements: 2.4, 4.4_

- [ ] 7.2 ゲーム制御ボタンの実装
  - 新しい問題生成ボタンを実装
  - リセットボタンの機能を作成
  - 元に戻すボタンの機能を実装
  - ゲーム制御機能の統合テストを作成
  - _Requirements: 1.1, 1.4, 4.1, 4.3_

- [ ] 8. 統合テストとエンドツーエンドテストの実装
- [ ] 8.1 コンポーネント間連携テストの作成
  - UI操作からゲーム状態更新までの統合テストを実装
  - エラー表示連携の統合テストを作成
  - ゲーム完了フローの統合テストを実装
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [ ] 8.2 エンドツーエンドシナリオテストの作成
  - 新規ゲーム開始から完了までのE2Eテストを実装
  - エラー修正フローのE2Eテストを作成
  - リセット・元に戻す機能のE2Eテストを実装
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 4.1, 4.2, 4.3_

- [ ] 9. 将来拡張対応の基盤実装
- [ ] 9.1 ルール抽象化とプラグイン機構の実装
  - BaseRuleクラスとルールプラグイン機構を実装
  - GridConfigクラスによるサイズ設定機能を作成
  - 拡張性テストケースを実装
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [x] 10. 候補数字機能（ペンシルマーク）の実装
- [x] 10.1 データモデル拡張
  - Grid.jsに候補数字データ構造を追加
  - 候補数字の設定・取得・削除メソッドを実装
  - GameState.jsに候補数字の履歴管理機能を追加
  - 候補数字操作のundo/redo機能を実装
  - _Requirements: ユーザビリティ向上_
  - **完了日: 2025-07-25**

- [x] 10.2 UI/CSS設計と実装
  - セル内3×3候補グリッドのCSSレイアウトを実装
  - 小さい数字のフォントサイズ・位置調整
  - メイン数字との視覚的区別を実装
  - HTML構造の候補数字表示エリアを追加
  - _Requirements: ユーザビリティ向上_
  - **完了日: 2025-07-25**

- [x] 10.3 操作機能実装
  - メイン入力モード / 候補入力モードの切り替え機能
  - キーボードショートカット（Shift+数字）の実装
  - UIControllerに候補数字入力処理を追加
  - セル選択時の候補数字表示機能
  - _Requirements: ユーザビリティ向上_
  - **完了日: 2025-07-25**

- [x] 10.4 自動機能とヒント
  - セル選択時の可能な候補数字自動表示
  - ルール違反候補の自動除外機能
  - メイン数字設定時の関連候補自動削除
  - 同一行・列・ブロック内での候補自動管理
  - _Requirements: ユーザビリティ向上_
  - **完了日: 2025-07-25**

- [x] 10.5 候補数字機能のテスト
  - 候補数字データモデルの単体テスト
  - 候補操作機能のテスト
  - UI操作の統合テスト
  - メイン入力と候補入力の連携テスト
  - _Requirements: 品質保証_
  - **完了日: 2025-07-25**

- [x] 10.6 候補数字表示方式の修正
  - 候補に選択されていない数字の非表示対応
  - 3×3グリッド内での正しい位置表示の実装
  - CSS: `.candidate-number`のデフォルト非表示化
  - UIController: 候補グリッド表示ロジックの修正
  - 動作確認とテスト実行
  - _Requirements: ユーザビリティ向上_
  - **完了日: 2025-07-25**

- [x] 10.7 関連候補自動削除機能の実装
  - Grid.js: 関連セル取得機能の追加（同一行・列・ブロック）
  - GameState.js: 通常入力時の関連候補自動削除機能実装
  - 履歴管理: 候補削除操作の履歴記録とundo対応
  - UIController.js: 複数セル更新時の画面表示対応
  - 単体テスト: 候補自動削除機能のテストケース作成
  - _Requirements: ユーザビリティ向上、操作効率化_
  - **完了日: 2025-07-25**

- [x] 10.8 入力モード表示の改善
  - HTML: 画面右上の入力モード表示を削除し、切替ボタン横に統合
  - CSS: 切替ボタンを角丸、状態表示を四角に変更
  - CSS: mode-controlsのレイアウトを横並びに調整
  - UIController.js: 重複表示の修正と表示位置の変更
  - レスポンシブ対応の調整
  - _Requirements: UI/UXの改善、視認性向上_
  - **完了日: 2025-07-25**

- [x] 10.9 数字使用状況表示機能の実装
  - HTML: グリッド上部に数字使用状況表示エリアを追加
  - CSS: 1〜9の数字横並び表示と完了状態のグレーアウトスタイル
  - GameState.js: 数字使用数カウント機能の追加
  - UIController.js: 使用状況表示の初期化と更新処理
  - 通常入力・undo・リセット時の表示更新連携
  - _Requirements: ゲームプレイの利便性向上、進捗可視化_
  - **完了日: 2025-07-25**

- [x] 10.10 入力フローの変更（数字先選択方式）
  - UIController.js: selectedCellからselectedNumber方式への状態管理変更
  - イベント処理の変更: 数字ボタンで数字選択、マスクリックで入力実行
  - CSS: 選択中数字ボタンのハイライト表示、マス選択スタイルの調整
  - キーボード操作の変更: 数字キーで数字選択、Escで選択解除
  - 通常入力・候補入力両モードでの動作対応
  - _Requirements: UI/UXの改善、操作効率向上_
  - **完了日: 2025-07-25**

- [x] 10.11 一時停止機能の実装
  - HTML: 一時停止/再開ボタンと盤面隠し用オーバーレイの追加
  - CSS: 一時停止中の盤面隠しスタイルとメッセージ表示
  - UIController.js: 一時停止/再開処理と操作制限の実装
  - GameState.js: 一時停止時間の正確な計測とタイマーバグ修正
  - 一時停止中の入力無効化とタイマー停止制御
  - _Requirements: ゲーム中断機能、プライバシー保護_
  - **完了日: 2025-07-26**

- [x] 10.12 盤面保存・復元機能の実装
  - GameState.js: 盤面保存用データ構造とsaveGameState()メソッドの実装
  - GameState.js: restoreGameState()とhasSavedState()メソッドの実装
  - HTML: 盤面保存・復元ボタンをゲームコントロール部分に追加
  - CSS: 保存・復元ボタンのスタイルと無効状態表示の実装
  - UIController.js: 保存・復元ボタンのイベント処理と状態管理
  - 単体テスト: 保存・復元機能の整合性検証とエラーケーステスト
  - _Requirements: 分岐点での試行錯誤支援、ゲームプレイ効率向上_
  - **完了日: 2025-07-26**

- [x] 10.13 UIレイアウトの改善（ボタン配置最適化）
  - HTML: ヘッダーから4つのボタン（元に戻す、一時停止、盤面保存、盤面復元）を削除
  - HTML: 経過時間の下に新しいgame-operationsセクションを追加し4つのボタンを配置
  - CSS: 既存のgame-controlsスタイルを2つのボタン用に調整
  - CSS: 新しいgame-operationsスタイルで4つのボタンを横並び配置
  - CSS: 切り替えボタンの背景色を通常入力・候補入力の色と被らない色に変更（緑色#27ae60）
  - レスポンシブデザイン: モバイル表示での4つのボタン配置調整（縦並び配置）
  - 動作テスト: レイアウト確認と機能テスト
  - _Requirements: UI/UXの改善、使用頻度に応じたボタン配置最適化_
  - **完了日: 2025-07-26**

- [x] 10.14 パズル共有機能（呪文システム）の実装
  - 呪文システム設計: Base64エンコードによる盤面データの圧縮・共有フォーマット
  - GameState.js: generateSpell()メソッドで初期盤面から呪文を生成
  - GameState.js: parseSpell()メソッドで呪文から盤面データを復元（複雑度対応でメソッド分割）
  - HTML: 「呪文の問題」「呪文を取得」ボタンをヘッダーに追加
  - HTML: 呪文入力・表示用のモーダルダイアログ実装
  - CSS: 4つのボタンレイアウトと呪文入力ダイアログのスタイリング・レスポンシブ対応
  - UIController.js: 呪文生成・解読のイベント処理とダイアログ制御
  - ユーザビリティ: クリップボードAPIによる自動コピー機能とフォールバック対応
  - 単体テスト: 19個のテストケースで呪文生成・解読機能とエラーハンドリングの包括的テスト
  - README.md・LICENSEファイル作成: プロジェクトドキュメント整備
  - _Requirements: パズル共有機能、コミュニティ形成支援_
  - **完了日: 2025-07-26**

- [x] 10.15 UI統一化（ボタンデザインと色の一貫性向上）
  - CSS変数定義: 統一的なテーマ管理のための変数設定（色、角丸、トランジション）
  - 色の統一: 基本ボタン色を緑色（#27ae60）に統一、無効ボタンは#bdc3c7
  - 3Dボタンデザイン: 角丸（border-radius: 8px）と立体感（box-shadow）の実装
  - 押下エフェクト: :activeでの押し込み効果（transform: translateY）実装
  - 一般ボタンの統一: ヘッダー、ゲーム操作、モーダル内ボタンすべてに適用
  - 数字選択ボタンの特別対応: デフォルト白、ホバー黄緑（#2ecc71）、選択時緑（#27ae60）
  - 消去ボタンの特別対応: デフォルト白地に赤文字、ホバー時赤地に白文字、選択時赤地に白文字でグロー効果
  - 非インタラクティブ要素: 入力モード表示、完了数字表示、ゲーム情報エリアは四角・フラットデザイン維持
  - アニメーション効果: ease-in-outトランジション、will-changeプロパティによる最適化
  - レスポンシブ対応: モバイル表示でのボタン3D効果調整（控えめなエフェクト）
  - エラー色系CSS変数追加: --error-color、--error-hover、--error-activeで赤色系統一管理
  - _Requirements: UI/UXの改善、視覚的統一感の向上、操作性の向上_
  - **完了日: 2025-07-26**

- [x] 10.16 数字選択ボタンの色管理統一（マウスオーバー・選択状態の一貫性向上）
  - CSS変数名の統一: primary-hover→primary-dark、error-hover→error-light、error-active→error-darkに変更
  - 色の挙動統一: マウスオーバー時は明るい色、押下時は暗い色の一貫したルール実装
  - 数字ボタンの色挙動完成:
    - デフォルト状態: 白背景（#ffffff）
    - マウスオーバー状態: 明るい緑背景（#2ecc71）
    - アクティブ（押下中）状態: 暗い緑背景（#229954）
    - 選択状態: 中間緑背景（#27ae60）
    - 選択状態でマウスオーバー: 明るい緑背景（#2ecc71）で統一
    - 選択状態でアクティブ: 暗い緑背景（#229954）
  - 消去ボタンの赤色系統一ルール適用:
    - デフォルト: 白背景に赤文字
    - マウスオーバー: 明るい赤背景（#ec7063）
    - アクティブ: 暗い赤背景（#c0392b）
    - 選択+ホバー: 明るい赤背景、選択+アクティブ: 暗い赤背景
  - _Requirements: UI/UXの改善、色の一貫性向上、直感的な操作感向上_
  - **完了日: 2025-07-26**

- [x] 10.17 一般ボタンの色ルール統一（マウスオーバー・押下時の一貫性向上）
  - 統一された色の挙動: 選択状態のない一般ボタンに最適化された色設定
  - 対象ボタン: 新しい問題、元に戻す、一時停止、盤面保存、盤面復元、切り替えボタンなど
  - 色の挙動完成:
    - デフォルト状態: 明るい緑背景（#2ecc71）- 常に押せる状態を視覚的に表現
    - マウスオーバー状態: 明るい緑背景（#2ecc71）維持、影と位置変化でフィードバック
    - アクティブ（押下中）状態: 暗い緑背景（#229954）- 押下感を明確に表現
  - .btn、.btn-primary、.btn-secondary、#toggle-input-modeの背景色とスタイル修正
  - デフォルト色調整: .btn-primary、.btn-secondary、#toggle-input-modeをvar(--primary-light)に変更
  - CSS詳細度問題修正: .btn-primary:activeと.btn-secondary:activeを個別定義で押下時色を確実に適用
  - 無効ボタン（:disabled）の色は変更せず現状維持
  - _Requirements: UI/UXの改善、全ボタンの操作感統一、直感的なフィードバック向上_
  - **完了日: 2025-07-26**

- [x] 10.18 UI色調整（明度を抑えた目に優しい色合いへの変更）
  - 緑色系の色調整: より落ち着いた色合いにワントーン下げる
    - primary-light: #2ecc71 → #27ae60（旧primary-color）
    - primary-color: #27ae60 → #229954（旧primary-dark）
    - primary-dark: #229954 → #1e8449（新しい暗色）
  - 赤色系の色調整: 緑色系と同様にワントーン下げる
    - error-light: #ec7063 → #e74c3c（旧error-color）
    - error-color: #e74c3c → #c0392b（旧error-dark）
    - error-dark: #c0392b → #a93226（新しい暗色）
  - グロー効果のRGBA値も新しい色に合わせて調整
  - CSS変数の統一的な色管理により全UI要素に一括適用
  - _Requirements: UI/UXの改善、視覚的負担軽減、長時間使用での目の疲労軽減_
  - **完了日: 2025-07-26**

- [ ] 11. 最終統合とパフォーマンス最適化
- [ ] 11.1 全機能統合とパフォーマンステスト
  - 全コンポーネントを統合してWebアプリケーションを完成
  - パフォーマンス測定とボトルネック特定を実施
  - 必要に応じて最適化を実装
  - 最終的な動作確認テストを実行
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4_